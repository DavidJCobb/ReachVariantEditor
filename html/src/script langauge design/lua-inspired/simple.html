<!doctype html>
<html>
   <head>
      <meta charset="UTF-8">
      <title>Simple megalo parser</title>
      <style>
textarea{width:100%;height:250px;box-sizing:border-box}
.two-cols{display:flex;flex-flow:row nowrap}
   .two-cols>div{flex:1 1 auto}
      </style>
   </head>
   <body>
      <p>
         The goal with this parser design is to only parse code that maps directly 
         to the final bitcode, i.e. code we can actually compile. Arbitrary expressions 
         don't meet that requirement: given something like <code>a += b * 3</code> we 
         would need to use a temporary to hold the result of <code>b * 3</code>, and we 
         can't reliably select a variable to serve as a temporary (or rather, a human 
         programmer could do that better than any automated algorithm).
      </p>
      <p>
         In the compiled bitcode, conditions can only consist of comparisons and function 
         calls, and actions (i.e. any statement that is not a condition) can only consist 
         of assignments (including mod-assignment operators like <code>+=</code> and 
         function calls. You can assign the result of a function call, but you cannot 
         compare directly to the result of a function call. The only other things allowed 
         are blocks and declarations. This "simple" parser is built around these limitations.
      </p>
      <p>
         In other words, the following are all syntax errors:
      </p>
      <pre>a += b + 5 -- use a += b a += 5
if a then end -- "a" by itself is not a comparison or function call
a = b().c -- cannot do property access on a function call
a = b() + 5 -- this is an expression; again, those are not supported
if a() == b() then -- function calls cannot appear directly in comparisons; do x = a() and then compare x</pre>
      <script src="std.js"></script>
      <script src="simple-validation.js"></script>
      <script src="simple.js"></script>
      <div class="two-cols">
         <div>
            <h1>Input</h1>
            <textarea id="in">abc = def
ghi = jkl(m, n, o, "p")
game.globals[1].number[3].qrs(tuv)

alias c = 5

function myFunc()
end

for each team do
   a = b
end

if a == b then
end
if c() then
end

if d == e then
   a = 1
elseif f == g then
   a = 2
else
   a = 3
end
</textarea>
            <br />
            <input type="button" value="Go! (writes to console)" id="go" />
         </div>
         <div>
            <h1>Output</h1>
            <textarea id="out"></textarea>
         </div>
      </div>
      <script>
         document.getElementById("go").addEventListener("click", function(e) {
            let parser = new MSimpleParser();
            let result = parser.parse(document.getElementById("in").value);
            console.log(result);
            console.log(parser);
            //
            let node = document.getElementById("out");
            node.value = "";
            if (result) {
               node.value = result.serialize();
            }
            //
            let validator = new MValidator;
            result.validate(validator);
            console.log(validator);
         });
      </script>
   </body>
</html>