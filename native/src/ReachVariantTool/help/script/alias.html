<!doctype html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      
      <title>Aliases | ReachVariantTool Documentation</title>
      <base href="../" />
      <link rel="stylesheet" href="resources/main.css" />
      <noscript>
         <link rel="stylesheet" href="resources/noscript.css" />
      </noscript>
      <script src="resources/head.js"></script>
   </head>
   <body>
      <nav id="sidebar">
         <ul>
            <li><a href="index.html">Index</a></li>
            <li>
               <a>Main Window</a>
               <ul>
                  <li>
                     <a href="editor/main_window/index.html">Multiplayer</a>
                     <ul>
                        <li><a href="editor/main_window/metadata.html">Metadata</a></li>
                        <li><a href="editor/main_window/options-general.html">General Settings</a></li>
                        <li><a href="editor/main_window/options-respawn.html">Respawn Settings</a></li>
                        <li><a href="editor/main_window/options-social.html">Social Settings</a></li>
                        <li><a href="editor/main_window/options-map.html">Map and Game Settings</a></li>
                        <li data-dont-default-collapse>
                           <a href="editor/main_window/options-team.html">Team Settings</a>
                           <ul>
                              <li><a href="editor/main_window/options-team-specific.html">Individual Team Settings</a></li>
                           </ul>
                        </li>
                        <li data-dont-default-collapse>
                           <a href="editor/main_window/options-loadout.html">Loadout Settings</a>
                           <ul>
                              <li><a href="editor/main_window/options-loadout-specific.html">Individual Loadout Settings</a></li>
                           </ul>
                        </li>
                        <li><a href="editor/main_window/options-megalo.html">Script-Specific Settings</a></li>
                        <li><a href="editor/main_window/option-visibility.html">Option Visibility</a></li>
                        <li><a href="editor/main_window/tu1.html">Title Update Settings</a></li>
                        <li><a href="editor/main_window/traits.html">(all player traits)</a></li>
                        <li><a href="editor/main_window/forge.html">Forge Settings</a></li>
                     </ul>
                  </li>
                  <li>
                     <a href="editor/main_window_ff/index.html">Firefight</a>
                     <ul>
                        <li><a href="editor/main_window_ff/metadata.html">Metadata</a></li>
                        <li>
                           <a href="editor/main_window_ff/scenario.html">Firefight Settings</a>
                           <ul>
                              <li><a href="editor/main_window_ff/lives.html">Player Lives</a></li>
                              <li><a href="editor/main_window_ff/options-respawn.html">Respawn Settings</a></li>
                              <li><a href="editor/main_window_ff/round.html">Round Settings</a></li>
                              <li><a href="editor/main_window_ff/bonus-wave.html">Bonus Wave Settings</a></li>
                              <li><a href="editor/main_window_ff/custom-skull.html">Custom Skulls</a></li>
                           </ul>
                        </li>
                        <li>
                           <a>Other Settings</a>
                           <ul>
                              <li><a href="editor/main_window_ff/options-general.html">General Settings</a></li>
                              <li><a href="editor/main_window_ff/options-social.html">Social Settings</a></li>
                              <li data-dont-default-collapse>
                                 <a href="editor/main_window_ff/options-team.html">Team Settings</a>
                                 <ul>
                                    <li><a href="editor/main_window_ff/options-team-specific.html">Individual Team Settings</a></li>
                                 </ul>
                              </li>
                              <li data-dont-default-collapse>
                                 <a href="editor/main_window_ff/options-loadout.html">Loadout Settings</a>
                                 <ul>
                                    <li><a href="editor/main_window_ff/options-loadout-specific.html">Individual Loadout Settings</a></li>
                                 </ul>
                              </li>
                           </ul>
                        </li>
                        <li><a href="editor/main_window_ff/traits.html">(all player traits)</a></li>
                        <li><a href="editor/main_window_ff/traits-wave.html">(all wave traits)</a></li>
                     </ul>
                  </li>
               </ul>
            </li>
            <li>
               <a href="editor/script_window/index.html">Script Window</a>
               <ul>
                  <li><a href="editor/script_window/meta-strings.html">Metadata Strings</a></li>
                  <li>
                     <a href="editor/script_window/string-table.html">All Other Strings</a>
                     <ul>
                        <li><a href="editor/script_window/string-localization.html">Editing and Localization</a></li>
                     </ul>
                  </li>
                  <li><a href="editor/script_window/forge-labels.html">Forge Labels</a></li>
                  <li><a href="editor/script_window/map-permissions.html">Map Permissions</a></li>
                  <li><a href="editor/script_window/player-rating-parameters.html">Player Rating Parameters</a></li>
                  <li><a href="editor/script_window/required-object-types.html">Required Object Types</a></li>
                  <li><a href="editor/script_window/script-options.html">Scripted Options</a></li>
                  <li><a href="editor/script_window/script-traits.html">Scripted Traits</a></li>
                  <li><a href="editor/script_window/script-stats.html">Scripted Stats</a></li>
                  <li><a href="editor/script_window/script-widgets.html">Scripted Widgets</a></li>
                  <li><a href="editor/script_window/gametype-code.html">Gametype Code</a></li>
               </ul>
            </li>
            <li>
               <a href="script/syntax.html">Scripting Language</a>
               <ul>
                  <li><a href="script/alias.html">Aliases</a></li>
                  <li><a href="script/events.html">Events</a></li>
                  <li><a href="script/for.html">For-each-loops</a></li>
                  <li><a href="script/if.html">If-/alt-statements</a></li>
                  <li><a href="script/operators.html">Operators</a></li>
                  <li><a href="script/string-special-chars.html">Special string characters</a></li>
                  <li><a href="script/enum.html">User-defined enums</a></li>
                  <li><a href="script/function.html">User-defined functions</a></li>
                  <li><a href="script/snippets.html">Useful code snippets</a></li>
                  <li><a href="script/declare.html">Variable declarations</a></li>
                  <li><a href="script/best-practices.html">Best practices</a></li>
                  <li data-dont-default-collapse>
                     <a>Advanced</a>
                     <ul>
                        <li><a href="script/scripted-object-count-limit.html">Scripted object count limit</a></li>
                        <li><a href="script/inline.html">Inlined triggers</a></li>
                        <li><a href="script/under-the-hood.html">Under the hood</a></li>
                     </ul>
                  </li>
               </ul>
            </li>
            <li>
               <a href="script/api/index.html">Script API reference</a>
               <ul>
                  <li data-dont-default-collapse>
                     <a>Namespaces</a>
                     <ul>
                        <li><a href="script/api/ns_unnamed.html">Content not in any namespace</a></li>
                        <li><a href="script/api/ns_enums.html">enums</a></li>
                        <li><a href="script/api/ns_game.html">game</a></li>
                        <li><a href="script/api/ns_global.html">global</a></li>
                        <li><a href="script/api/ns_temporaries.html">temporaries</a></li>
                     </ul>
                  </li>
                  <li data-dont-default-collapse>
                     <a>Types</a>
                     <ul>
                        <li data-dont-default-collapse>
                           <a>Variables</a>
                           <ul>
                              <li><a href="script/api/number.html">Number</a></li>
                              <li><a href="script/api/object.html">Object</a></li>
                              <li><a href="script/api/player.html">Player</a></li>
                              <li><a href="script/api/team.html">Team</a></li>
                              <li><a href="script/api/timer.html">Timer</a></li>
                           </ul>
                        </li>
                        <li data-dont-default-collapse>
                           <a>Misc</a>
                           <ul>
                              <li><a href="script/api/bool.html">Bool</a></li>
                              <li><a href="script/api/engine-icon.html">Engine Icon</a></li>
                              <li><a href="script/api/forge-label.html">Forge Label</a></li>
                              <li><a href="script/api/format-string.html">Format String</a></li>
                              <li><a href="script/api/incident.html">Incident</a></li>
                              <li><a href="script/api/object-type.html">Object Type</a></li>
                              <li><a href="script/api/player-set.html">Player Set</a></li>
                              <li><a href="script/api/traits.html">Player Traits</a></li>
                              <li><a href="script/api/sound.html">Sound</a></li>
                              <li><a href="script/api/variant-string-id.html">Variant ID</a></li>
                              <li><a href="script/api/waypoint-icon.html">Waypoint Icon</a></li>
                              <li><a href="script/api/widget.html">Widget</a></li>
                              <li><a href="script/api/widget-icon.html">Widget Icon</a></li>
                           </ul>
                        </li>
                     </ul>
                  </li>
               </ul>
            </li>
            <li>
               <a>Concepts</a>
               <ul>
                  <li><a href="concepts/bipeds-and-items.html">Bipeds and items</a></li>
                  <li><a href="concepts/coordinates.html">Coordinates</a></li>
                  <li><a href="concepts/firefight.html">Firefight</a></li>
               </ul>
            </li>
         </ul>
      </nav>
      <main>
         <h1>Aliases</h1>
      <p>
         Megalo only supports a limited number of variables; however, you can define 
         <dfn>aliases</dfn>, or custom names, for each variable. Once defined, an 
         alias can be used in any context where the original variable could be used.
      </p>
      <pre>
<span class="keyword">alias</span> is_zombie = player.number[0]

<span class="keyword">for</span> <span class="subkeyword">each</span> <span class="subkeyword">player</span> <span class="keyword">do</span>
   <span class="keyword">if</span> current_player.is_zombie == 1 <span class="keyword">then</span>
      <span class="comment">--</span>
      <span class="comment">-- ...</span>
      <span class="comment">--</span>
   <span class="keyword">end</span>
<span class="keyword">end</span></pre>
      <p>
         You can also alias certain values that are specific to argument types, such as 
         object types:
      </p>
      <pre>
<span class="keyword">alias</span> temp_int_00   = global.number[0]
<span class="keyword">alias</span> objective_obj = flag

<span class="keyword">for</span> <span class="subkeyword">each</span> <span class="subkeyword">team</span> <span class="keyword">do</span>
   <span class="keyword">alias</span> created = temp_int_00
   <span class="comment">--</span>
   created = 0
   <span class="keyword">for</span> <span class="subkeyword">each</span> <span class="subkeyword">object</span> <span class="subkeyword">with</span> <span class="subkeyword">label</span> <span class="string">"ctf_return</span>" <span class="keyword">do</span>
      <span class="keyword">if</span> created == 0 <span class="keyword">and</span> current_object.team == current_team <span class="keyword">then</span>
         current_object.place_at_me(objective_obj, none, never_garbage_collect, 0, 0, 0, none)
         created = 1
      <span class="keyword">end</span>
   <span class="keyword">end</span>
<span class="keyword">end</span></pre>
      
      <h2>Features of aliases</h2>
      
      <h3>Absolute or relative</h3>
      <p>
         Aliases can be "absolute" or "relative." An absolute alias refers to an integer 
         constant or to a global value, while a relative alias refers to a nested variable.
      </p>
      <pre>
<span class="keyword">alias</span> absolute_constant = 5

<span class="keyword">alias</span> absolute_variable = global.number[0]

<span class="keyword">if</span> absolute_variable == 1 <span class="keyword">then</span>
   <span class="comment">-- ...</span>
<span class="keyword">end</span>

<span class="comment">--</span>
<span class="comment">-- Relative alias:</span>
<span class="comment">--</span>

<span class="keyword">alias</span> relative_variable = player.number[0]

<span class="keyword">for</span> <span class="subkeyword">each</span> <span class="subkeyword">player</span> <span class="keyword">do</span>
   <span class="keyword">if</span> current_player.relative_variable == 1 <span class="keyword">then</span>
      <span class="comment">-- ...</span>
   <span class="keyword">end</span>
<span class="keyword">end</span></pre>
      <p>
         In that code example, we define <var>relative_variable</var> as an alias that 
         can be accessed on all player-type variables; the alias refers to any given 
         player's nested <code>number[0]</code> variable.
      </p>
      
      <h3>Scoping</h3>
      <p>
         Aliases are <dfn>block-scoped</dfn>. This means that they only exist inside of 
         the block of code they were defined in; they <dfn>go out of scope</dfn> — 
         they stop existing — past the end of that block.
      </p>
      <pre>
<span class="comment">-- Let's mark a variable for temporary use, with an alias.</span>
<span class="keyword">alias</span> temporary_number_variable = global.number[0]

<span class="keyword">for</span> <span class="subkeyword">each</span> <span class="subkeyword">player</span> <span class="keyword">do</span>
   <span class="keyword">if</span> current_player.killer_type_is(kill) <span class="keyword">then</span>
      <span class="keyword">alias</span> death_type = temporary_number_variable
      
      death_type = current_player.get_death_damage_type()
      <span class="keyword">if</span> death_type == enums.damage_reporting_type.dmr <span class="keyword">then</span>
         <span class="comment">--</span>
         <span class="comment">-- (current_player) was killed with a DMR.</span>
         <span class="comment">--</span>
      <span class="keyword">end</span>
   <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">-- The "death_type" alias isn't available here, so it doesn't make a mess.</span></pre>
      <p>
         Aliases that are defined outside of all blocks will never go out of scope; they 
         are always <dfn>in-scope</dfn> — always available from the current scope.
      </p>
      
      <h3>Shadowing</h3>
      <p>
         Aliases <dfn>shadow</dfn> each other. That is: if you define multiple aliases 
         with the same name, the most recently defined one (i.e. the one furthest down 
         in the code) will prevent access to the others.
      </p>
      <pre>
global.number[0] = 3

<span class="keyword">alias</span> example_alias = 1
<span class="keyword">alias</span> example_alias = 2
<span class="keyword">alias</span> example_alias = 3 <span class="comment">-- This alias shadows the others...</span>

<span class="keyword">if</span> global.number[0] == example_alias <span class="keyword">then</span>
   <span class="comment">-- ...so code in this block will run.</span>
<span class="keyword">end</span></pre>
      <p>
         Shadowing is affected by scoping:
      </p>
      <pre>
<span class="keyword">alias</span> example = 1

<span class="keyword">for</span> <span class="subkeyword">each</span> <span class="subkeyword">player</span> <span class="keyword">do</span>
   <span class="keyword">alias</span> example = 5 <span class="comment">-- Shadows the other alias.</span>
   
   current_player.number[0] = example
<span class="keyword">end</span>
<span class="comment">-- The "shadowing" alias isn't in-scope anymore. The alias that was once shadowed </span>
<span class="comment">-- is now available: `example` is now `1`.</span></pre>
      
      <h2>Allocation to aliases</h2>
      <p>
         Variables can be <dfn>allocated</dfn> to aliases dynamically. That is: you can 
         ask for a variable of a given type, without having to manually specify the 
         variable's index.
      </p>
      <pre>
<span class="keyword">alias</span> absolute_alias = <span class="keyword">allocate</span> global.number

<span class="keyword">alias</span> relative_alias = <span class="keyword">allocate</span> player.number</pre>
      <p>
         For these alias declarations, ReachVariantTool will look for any variable of 
         the requested type that is not already pointed to by an alias that is in-scope, 
         and use the first such variable that it finds. If no such variables remain (i.e. 
         every variable of the type you've asked for is already aliased), then a compiler 
         error will occur.
      </p>
      <pre>
<span class="keyword">alias</span> some_alias = global.number[0]

<span class="comment">-- The `global.number[0]` variable is referred to by another alias, so while </span>
<span class="comment">-- there's no guarantee that `example` will refer to any specific global.number </span>
<span class="comment">-- variable, there *is* a guarantee that it *won't* refer to `global.number[0]`.</span>
<span class="keyword">alias</span> example  = <span class="keyword">allocate</span> global.number</pre>
      <p>
         You can also allocate <a href="script/api/ns_temporaries.html">temporary variables</a> using 
         a special syntax:
      </p>
      <pre>
<span class="keyword">alias</span> my_temporary_variable = <span class="keyword">allocate</span> <span class="subkeyword">temporary</span> number</pre>
      
      <h3>Collision warnings</h3>
      <p>
         If you accidentally point an alias at a variable that was allocated to another 
         alias, the compiler will warn you.
      </p>
      <pre>
<span class="comment">-- Assume this is the only code in the entire script.</span>

<span class="keyword">alias</span> example_allocated = <span class="keyword">allocate</span> global.number
<span class="comment">-- Because no other global.number variables have been aliased, this will be </span>
<span class="comment">-- the global.number[0] variable.</span>

<span class="keyword">alias</span> example_explicit = global.number[0]
<span class="comment">-- This will generate a warning. The compiler will tell you that the other </span>
<span class="comment">-- alias, `example_allocated`, just happened to end up using the variable </span>
<span class="comment">-- that you're now also assigning to this alias.</span>

<span class="keyword">alias</span> example_borrowed = example_allocated
<span class="comment">-- This does not generate a warning. You clearly intend for both of these </span>
<span class="comment">-- aliases to point to the same variable, because you're making the one </span>
<span class="comment">-- alias point to the other alias.</span></pre>
      <p>
         The reason this warning exists is because if you run into this situation, it 
         likely won't be on purpose. While it <em>is</em> possible to predict which 
         variable will be allocated to any given alias, the whole point of allocating 
         variables to aliases (as opposed to choosing variables manually) is that you 
         shouldn't actually have to care what variable ends up in that alias.
      </p>
      <p>
         If you get this warning, you would generally want to either allocate variables 
         to aliases after all manually-set aliases, or change the manually-set alias to 
         one that allocates a variable.
      </p>
      
      <h3>User-defined functions</h3>
      <p>
         Allocation-to-aliases works inside of user-defined functions; however, there 
         are technical limitations that arise as a result of flaws in ReachVariantTool's 
         design.
      </p>
      <p>
         If a user-defined function is in scope, and the function definition contains 
         aliases, then none of the aliased variables can be allocated to a new alias 
         until the function goes out of scope. This is an exception to the normal rules 
         for allocation-to-aliases, and is a safety measure to prevent variable collisions 
         in situations like the following:
      </p>
      <pre>
<span class="keyword">function</span> some_helper_function()
   <span class="keyword">alias</span> local_variable = <span class="keyword">allocate</span> <span class="subkeyword">temporary</span> number
   
   local_variable = 5
<span class="keyword">end</span>

<span class="keyword">alias</span> some_important_variable = <span class="keyword">allocate</span> <span class="subkeyword">temporary</span> number
some_important_variable = 1

some_helper_function()

<span class="keyword">if</span> some_important_variable != 1 <span class="keyword">then</span>
   game.show_message_to(all_players, none, <span class="string">"Oh no!</span>")
<span class="keyword">end</span></pre>
      <p>
         In that code snippet, we allocate a temporary variable to an alias, <var>local_variable</var>, 
         inside the function. However, once we reach the end of the function body, that alias is, 
         technically, out of scope. The only way to prevent <var>some_important_variable</var> from 
         accidentally reusing that same variable — leading to a variable collision, where 
         calling the function accidentally <a href="https://en.wikipedia.org/wiki/Clobbering" target="_blank">clobbers</a> 
         data in the caller — is to make it so that variables that are aliased in any in-scope 
         function are reserved.
      </p>
      <p>
         This is a very imperfect workaround. In the following situation, for example, both of the 
         user-defined functions are forced to use separate variables even though there's no risk 
         of a collsiion between them (because neither function calls the other):
      </p>
      <pre>
<span class="keyword">function</span> first()
   <span class="keyword">alias</span> first_alias = <span class="keyword">allocate</span> <span class="subkeyword">temporary</span> number
<span class="keyword">end</span>

<span class="keyword">function</span> second()
   <span class="keyword">alias</span> second_alias = <span class="keyword">allocate</span> <span class="subkeyword">temporary</span> number
<span class="keyword">end</span></pre>
      <p>
         This is all necessary because of technical limitations in ReachVariantTool's design: it 
         only reads your code once, and it never backtracks to revise what it's compiled. When it 
         sees the definition of <code>second_alias</code>, it hasn't yet read the rest of <code>second()</code>, 
         so it doesn't know for sure whether <code>second()</code> calls <code>first()</code>; it only 
         knows that <code>second()</code> <em>can</em> call <code>first()</code>, so it gives <code>second()</code> 
         a separate variable in order to avoid any potential collisions.
      </p>
      <p>
         A side-effect of this is that if you define a function outside of any other block, and that 
         function allocates temporary variables, then you will accidentally reserve those variables 
         for the entire rest of the script, preventing any other code from reusing them. One fix for  
         this is to nest your functions in whatever blocks of code actually use them.
      </p>
   
      </main>
      <script src="resources/sidebar.js"></script>
      <script src="resources/header-links.js"></script>
   </body>
</html>