<!doctype html>
<html>
   <head>
      <meta charset="UTF-8" />
      <title>Useful code snippets | ReachVariantTool Documentation</title>
      <base href="../" />
      <link rel="stylesheet" href="resources/main.css" />
      <noscript>
         <link rel="stylesheet" href="resources/noscript.css" />
      </noscript>
   </head>
   <body>
      <nav id="sidebar">
         <ul>
            <li><a href="index.html">Index</a></li>
            <li>
               <a href="editor/main_window/index.html">Main Window</a>
               <ul>
                  <li><a href="editor/main_window/metadata.html">Metadata</a></li>
                  <li><a href="editor/main_window/options-general.html">General Settings</a></li>
                  <li><a href="editor/main_window/options-respawn.html">Respawn Settings</a></li>
                  <li><a href="editor/main_window/options-social.html">Social Settings</a></li>
                  <li><a href="editor/main_window/options-map.html">Map and Game Settings</a></li>
                  <li>
                     <a href="editor/main_window/options-team.html">Team Settings</a>
                     <ul>
                        <li><a href="editor/main_window/options-team-specific.html">Individual Team Settings</a></li>
                     </ul>
                  </li>
                  <li>
                     <a href="editor/main_window/options-loadout.html">Loadout Settings</a>
                     <ul>
                        <li><a href="editor/main_window/options-loadout-specific.html">Individual Loadout Settings</a></li>
                     </ul>
                  </li>
                  <li><a href="editor/main_window/options-megalo.html">Script-Specific Settings</a></li>
                  <li><a href="editor/main_window/option-visibility.html">Option Visibility</a></li>
                  <li><a href="editor/main_window/tu1.html">Title Update Settings</a></li>
                  <li><a href="editor/main_window/forge.html">Forge Settings</a></li>
               </ul>
            </li>
            <li>
               <a href="editor/script_window/index.html">Script Window</a>
               <ul>
                  <li><a href="editor/script_window/meta-strings.html">Metadata Strings</a></li>
                  <li><a href="editor/script_window/string-table.html">All Other Strings</a></li>
                  <li><a href="editor/script_window/forge-labels.html">Forge Labels</a></li>
                  <li><a href="editor/script_window/map-permissions.html">Map Permissions</a></li>
                  <li><a href="editor/script_window/player-rating-parameters.html">Player Rating Parameters</a></li>
                  <li><a href="editor/script_window/required-object-types.html">Required Object Types</a></li>
                  <li><a href="editor/script_window/script-options.html">Scripted Options</a></li>
                  <li><a href="editor/script_window/script-traits.html">Scripted Traits</a></li>
                  <li><a href="editor/script_window/script-stats.html">Scripted Stats</a></li>
                  <li><a href="editor/script_window/script-widgets.html">Scripted Widgets</a></li>
                  <li><a href="editor/script_window/gametype-code.html">Gametype Code</a></li>
               </ul>
            </li>
            <li>
               <a href="script/syntax.html">Scripting Language</a>
               <ul>
                  <li><a href="script/alias.html">Aliases</a></li>
                  <li><a href="script/events.html">Events</a></li>
                  <li><a href="script/for.html">For-each-loops</a></li>
                  <li><a href="script/if.html">If-/alt-statements</a></li>
                  <li><a href="script/operators.html">Operators</a></li>
                  <li><a href="script/enum.html">User-defined enums</a></li>
                  <li><a href="script/function.html">User-defined functions</a></li>
                  <li><a href="script/snippets.html">Useful code snippets</a></li>
               </ul>
            </li>
            <li>
               <a href="script/api/index.html">Script API reference</a>
               <ul>
                  <li>
                     <a>Namespaces</a>
                     <ul>
                        <li><a href="script/api/ns_unnamed.html">Content not in any namespace</a></li>
                        <li><a href="script/api/ns_enums.html">enums</a></li>
                        <li><a href="script/api/ns_game.html">game</a></li>
                        <li><a href="script/api/ns_global.html">global</a></li>
                     </ul>
                  </li>
                  <li>
                     <a>Types</a>
                     <ul>
                        <li>
                           <a>Variables</a>
                           <ul>
                              <li><a href="script/api/number.html">Number</a></li>
                              <li><a href="script/api/object.html">Object</a></li>
                              <li><a href="script/api/player.html">Player</a></li>
                              <li><a href="script/api/team.html">Team</a></li>
                              <li><a href="script/api/timer.html">Timer</a></li>
                           </ul>
                        </li>
                        <li>
                           <a>Misc</a>
                           <ul>
                              <li><a href="script/api/bool.html">Bool</a></li>
                              <li><a href="script/api/engine-icon.html">Engine Icon</a></li>
                              <li><a href="script/api/forge-label.html">Forge Label</a></li>
                              <li><a href="script/api/format-string.html">Format String</a></li>
                              <li><a href="script/api/object-type.html">Object Type</a></li>
                              <li><a href="script/api/player-set.html">Player Set</a></li>
                              <li><a href="script/api/variant-string-id.html">Variant ID</a></li>
                              <li><a href="script/api/waypoint-icon.html">Waypoint Icon</a></li>
                              <li><a href="script/api/widget.html">Widget</a></li>
                              <li><a href="script/api/widget-icon.html">Widget Icon</a></li>
                           </ul>
                        </li>
                     </ul>
                  </li>
               </ul>
            </li>
         </ul>
      </nav>
      <main>
         <h1>Useful code snippets</h1>

      <p>
         The following code snippets are likely to be useful when making new gametypes 
         from scratch. Note that if a code snippet requires the use of a variable, you 
         will probably have to ensure that your own script doesn't use the same variable 
         for anything important.
      </p>
      
      <ul id="toc">
         <li><a href="script/snippets.html#dlc-achievements">DLC Achievements</a></li>
         <li><a href="script/snippets.html#loadout-palettes">Loadout palette code</a></li>
         <li><a href="script/snippets.html#round-timer">Round timer code (basic)</a></li>
         <li><a href="script/snippets.html#round-timer-sd">Round timer code (with Sudden Death)</a></li>
         <li><a href="script/snippets.html#super-shields">Super Shields</a></li>
      </ul>
      
      <h2><a name="dlc-achievements">DLC Achievements</a></h2>
      <p>
         Several DLC achievements are awarded by Megalo script instead of being hardcoded 
         into the game. These include:
      </p>
      <dl>
         <dt>Dive Bomber</dt>
            <dd>Assassinate an enemy player while using a Jetpack.</dd>
         <dt>From Hell's Heart</dt>
            <dd>After being stuck with a plasma grenade, make sure that the player who 
            stuck you dies in the blast with you.</dd>
         <dt>Top Shot</dt>
            <dd>Score three headshot kills in a row without dying.</dd>
         <dt>License to Kill</dt>
            <dd>Splatter five enemy players during a single match.</dd>
         <dt>Paper Beats Rock</dt>
            <dd>Assassinate an enemy player no more than three seconds after they stop 
            using Armor Lock.</dd>
      </dl>
      <p>
         This code was taken from official gametypes. In some cases, small adjustments 
         were made in order to avoid dependencies that you can't easily copy and paste 
         (e.g. using the
         <a href="script/api/object/conditions/is_of_type.html">object.is_of_type</a> 
         condition instead of using 
         <a href="script/api/object/conditions/has_forge_label.html">object.has_forge_label</a> 
         with unnamed Forge labels, as 343i does).
      </p>
      <pre>
alias ach_top_shot_count        = player.number[0]
alias ach_license_to_kill_count = player.number[1]
alias ach_paper_beats_rock_vuln_timer = player.timer[0]
declare player.ach_top_shot_count        with network priority low
declare player.ach_license_to_kill_count with network priority low

for each player do -- award Dive Bomber achievement as appropriate
   alias killer    = global.player[0]
   alias killer_aa = global.object[0]
   alias death_mod = global.number[0]
   if current_player.killer_type_is(kill) then 
      killer    = current_player.get_killer()
      death_mod = current_player.get_death_damage_mod()
      if death_mod == enums.damage_reporting_modifier.assassination then
         killer_aa = killer.get_armor_ability()
         if killer_aa.is_of_type(jetpack) and killer_aa.is_in_use() then 
            send_incident(dlc_achieve_2, killer, killer, 65)
         end
      end
   end
end

for each player do -- award From Hell's Heart achievement as appropriate
   alias death_mod = global.number[0]
   alias killer    = global.player[0]
   if current_player.killer_type_is(kill) then
      death_mod = current_player.get_death_damage_mod()
      if death_mod == enums.damage_reporting_modifier.sticky then
         killer = current_player.get_killer()
         if killer.killer_type_is(suicide) then 
            send_incident(dlc_achieve_2, current_player, current_player, 68)
         end
      end
   end
end

for each player do -- manage and award Top Shot achievement as appropriate
   alias killer    = global.player[0]
   alias death_mod = global.number[0]
   if current_player.killer_type_is(guardians | suicide | kill | betrayal | quit) then 
      current_player.ach_top_shot_count = 0
      if current_player.killer_type_is(kill) then 
         killer    = current_player.get_killer()
         death_mod = current_player.get_death_damage_mod()
         if death_mod != enums.damage_reporting_modifier.headshot then 
            killer.ach_top_shot_count = 0
         end
         if death_mod == enums.damage_reporting_modifier.headshot then 
            killer.ach_top_shot_count += 1
         end
         if killer.ach_top_shot_count &gt; 2 then 
            send_incident(dlc_achieve_2, killer, killer, 62)
         end
      end
   end
end

for each player do -- manage and award License To Kill achievement as appropriate
   alias killer    = global.player[0]
   alias death_mod = global.number[0]
   if current_player.killer_type_is(kill) then 
      killer    = current_player.get_killer()
      death_mod = current_player.get_death_damage_mod()
      if death_mod == enums.damage_reporting_modifier.splatter then 
         killer.ach_license_to_kill_count += 1
         if killer.ach_license_to_kill_count &gt; 4 then 
            send_incident(dlc_achieve_2, killer, killer, 66)
         end
      end
   end
end

for each player do -- manage timing for the Paper Beats Rock achievement
   alias current_ability = global.object[0]
   --
   current_ability = current_player.get_armor_ability()
   if current_ability.is_of_type(armor_lock) and current_ability.is_in_use() then 
      current_player.ach_paper_beats_rock_vuln_timer = 3
      current_player.ach_paper_beats_rock_vuln_timer.set_rate(-100%)
   end
end
for each player do -- award Paper Beats Rock achievement as appropriate
   alias killer    = global.player[0]
   alias death_mod = global.number[0]
   if current_player.killer_type_is(kill) and not current_player.ach_paper_beats_rock_vuln_timer.is_zero() then 
      death_mod = current_player.get_death_damage_mod()
      if death_mod == enums.damage_reporting_modifier.assassination then
         killer = current_player.get_killer()
         send_incident(dlc_achieve_2, killer, killer, 60)
      end
   end
end</pre>
      
      <h2><a name="loadout-palettes">Loadout palette code</a></h2>
      <p>
         Players will not have access to any loadout palette unless you give them access 
         to loadout palettes. Standard gametypes grant players access to the Spartan Tier 
         1 and Elite Tier 1 palettes depending on their species.
      </p>
      <pre>
for each player do -- loadout palettes
   if current_player.is_elite() then 
      current_player.set_loadout_palette(elite_tier_1)
   end
   if not current_player.is_elite() then 
      current_player.set_loadout_palette(spartan_tier_1)
   end
end</pre>
      
      <h2><a name="round-timer">Round timer code (basic)</a></h2>
      <p>
         <i>Halo: Reach</i> does not automatically end the round when the round timer 
         expires. Instead, Megalo has near-total authority over when the round ends.
      </p>
      <pre>
if game.round_time_limit &gt; 0 and game.round_timer.is_zero() then
   game.end_round()
end</pre>
      
      <h2><a name="round-timer-sd">Round timer code (with Sudden Death)</a></h2>
      <p>
         The code for a round timer with Sudden Death is a bit more complicated.
      </p>
      <p>
         Typically, Sudden Death will activate if, at the end of the round, a player is 
         in a position where they can attempt to complete the objective. For example, 
         during CTF, Sudden Death will activate if a player is standing very close to a 
         flag that they can pick up and capture.
      </p>
      <p>
         Typically, the Grace Period is used to complement Sudden Death. 
         Sudden Death activates when a player is able to further an 
         objective match; for example, it will enable if any player is 
         standing close to a flag that they can pick up and score. In 
         that scenario, if Sudden Death begins and then the conditions 
         for it are no longer met (the player stops being near the flag), 
         then the match will end after the Grace Period ends. Sudden 
         Death never resets (if a player comes near the flag again, the 
         timer will continue from where it left off), but the Grace 
         Period does.
      </p>
      <pre>
alias sudden_death_enabled   = global.number[0]
alias announced_sudden_death = global.number[1] -- only announce the start of Sudden Death once

if not game.round_timer.is_zero() then 
   game.grace_period_timer = 0
end
if game.round_time_limit &gt; 0 then 
   if not game.round_timer.is_zero() then 
      announced_sudden_death = 0
   end
   if game.round_timer.is_zero() then 
      if sudden_death_enabled == 1 then 
         game.sudden_death_timer.set_rate(-100%)
         game.grace_period_timer.reset()
         if announced_sudden_death == 0 then 
            send_incident(sudden_death, all_players, all_players)
            announced_sudden_death = 1
         end
         if game.sudden_death_time &gt; 0 and game.grace_period_timer &gt; game.sudden_death_timer then 
            game.grace_period_timer = game.sudden_death_timer
         end
      end
      if sudden_death_enabled == 0 then 
         game.grace_period_timer.set_rate(-100%)
         if game.grace_period_timer.is_zero() then 
            game.end_round()
         end
      end
      if game.sudden_death_timer.is_zero() then 
         game.end_round()
      end
   end
end</pre>
      
      <h2><a name="super-shields">Super Shields</a></h2>
      <p>
         Like the original <i>Halo: Combat Evolved</i>, <i>Halo: Reach</i> doesn't 
         display any extra graphics on players that have overshields. The 
         "<abbr title="Title Update">TU</abbr>" versions of many gametypes include 
         a new option called "Super Shields" which works around this, by spawning 
         fire particles on these players.
      </p>
      <pre>
alias opt_super_shields = script_option[12]
alias lifespan = object.timer[0]

-- This should be the index of a nameless Forge label whose object type 
-- is the fire particle emitter:
alias all_fire_particles = 7

for each player do -- handle super shields VFX
   if opt_super_shields == 1 then 
      alias current_shields = global.number[0]
      alias outcome = global.number[1]
      --
      current_shields = 0
      current_shields = current_player.biped.shields
      if current_shields &gt; 100 then 
         outcome = 0
         outcome = rand(10)
         if outcome &lt;= 2 then -- 30% chance to spawn a particle emitter
            current_player.biped.place_at_me(particle_emitter_fire, none, never_garbage_collect, 0, 0, 0, none)
         end
      end
   end
end
for each object with label all_fire_particles do -- clean up super shields VFX
   current_object.lifespan.set_rate(-100%)
   if current_object.lifespan.is_zero() then 
      current_object.delete()
   end
end</pre>
   
      </main>
      <script src="resources/sidebar.js"></script>
      <script src="resources/header-links.js"></script>
   </body>
</html>